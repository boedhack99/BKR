version: 2.1
jobs:
  build:
    docker:
      - image: fr3akyphantom/droid-builder:latest
    environment:
      ROM_NAME: 'LineageOS'
      VERSION: 'lineage-18.1'
      VENDOR: 'xiaomi'
      CODENAME: 'mojito'
      CHANGELOG: |
        - Initial Build
    working_directory: /home/builder/
    steps:
      - run:
          name: AIO Build
          command: |
            lshw -short
            df -h 
            echo "=============================================================="
           sudo apt-get -y update && sudo apt-get -y install git openjdk-8-jdk wget p7zip-full p7zip-rar python python3 rsync sshpass adb autoconf automake axel bc bison build-essential ccache clang cmake expat fastboot flex g++ g++-multilib gawk gcc gcc-multilib git gnupg gperf htop imagemagick lib32ncurses5-dev lib32z1-dev libtinfo5 libc6-dev libcap-dev libexpat1-dev libgmp-dev '^liblz4-.*' '^liblzma.*' libmpc-dev libmpfr-dev libncurses5-dev libsdl1.2-dev libssl-dev libtool libxml2 libxml2-utils '^lzma.*' lzop maven ncftp ncurses-dev patch patchelf pkg-config pngcrush pngquant python2.7 python-all-dev re2c schedtool squashfs-tools subversion texinfo unzip w3m xsltproc zip zlib1g-dev lzip libxml-simple-perl apt-utils 
           sudo curl --create-dirs -L -o /usr/local/bin/repo -O -L https://storage.googleapis.com/git-repo-downloads/repo
           sudo chmod a+rx /usr/local/bin/repo
           mkdir android && cd android
           repo init -u git://github.com/LineageOS/android.git -b lineage-18.1 --depth=1 --groups=all,-notdefault,-device,-darwin,-x86,-mips
           repo sync --force-sync -j69
           git clone --depth=1 --single-branch https://github.com/boedhack99/dxm -b R device/xiaomi/mojito
           git clone --depth=1 --single-branch https://github.com/boedhack/vendor_mojito -b R vendor/xiaomi/rosy
           git clone --depth=1 --single-branch https://github.com/PixelExperience-Devices/kernel_xiaomi_mojito -b eleven kenrel/xiaomi/mojito
           . build/envsetup.sh && lunch lineage_mojito-userdebug && mka sepolicy
workflows:
  version: 2.1
  build_and_test:
    jobs:
      - build:
          filters:
            branches:
              only: 'lineage-18.1'
          context: org-global
